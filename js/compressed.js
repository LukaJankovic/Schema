$(function(){$("#add").click(function(){$.getJSON("https://lserver.alite.am/apps/schema/res/skolmat.json",function(e){for(var a="",t="",o=0;o<e.length;o++)$("#add-skola").val()==e[o].name+" ("+e[o].city+")"&&(a=e[o].name,t=e[o].link);addSchool(a,t),window.location.href="https://lserver.alite.am/apps/schema/skolmat.html"})}),$("#cancel, #back-button").click(function(){window.location.href="https://lserver.alite.am/apps/schema/skolmat.html"})}),$(function(){$("#add").click(function(){$.getJSON("https://lserver.alite.am/apps/schema/res/schools.json",function(e){for(var a="",t="",o=0;o<e.length;o++)$("#add-skola").val()==e[o].namn+" ("+e[o].stad+")"&&(a=e[o].id,t=e[o].namn);addClass(a,t,$("#add-klass").val()),window.location.href="https://lserver.alite.am/apps/schema"})}),$("#cancel, #back-button").click(function(){window.location.href="https://lserver.alite.am/apps/schema"})}),addClass=function(e,a,t){console.log("school "+e),console.log("id "+t),schema=Cookies.get("schema"),"undefined"==typeof schema?schema=[]:schema=JSON.parse(schema);for(var o=0,n=0;n<schema.length;n++)schema[n].id==t&&schema[n].school==e&&schema[n].name==a&&(o=1);0==o&&schema.push({school:e,id:t,name:a}),Cookies.set("schema",schema,{expires:365})},deleteClass=function(e){var a=getSchemaFavourites();a.splice(e,1),Cookies.set("schema",a,{expires:365})},getSchemaFavourites=function(){return JSON.parse(Cookies.get("schema"))},addSchool=function(e,a){food=Cookies.get("food"),"undefined"==typeof food?food=[]:food=JSON.parse(food);for(var t=0,o=0;o<food.length;o++)food[o].school==e&&schema[o].id==a&&(t=1);0==t&&food.push({school:e,id:a}),Cookies.set("food",food,{expires:365})},deleteSchool=function(e){var a=getFoodFavourites();a.splice(e,1),Cookies.set("food",a,{expires:365})},getFoodFavourites=function(){return JSON.parse(Cookies.get("food"))},setLanguage=function(e){Cookies.set("lan",e,{expires:365})},getLanguage=function(){return Cookies.get("lan")?Cookies.get("lan"):"se"},clear=function(){Cookies.remove("lan"),Cookies.remove("food"),Cookies.remove("schema")};var dialogOpen=!1,showDialog,hideDialog;$(function(){clearAndShow=function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"https://lserver.alite.am/apps/schema/skolmat.html"==window.location.href?window.location.href="https://lserver.alite.am/apps/schema/add-food.html":window.location.href="https://lserver.alite.am/apps/schema/add-school.html":($("#add-skola").val(""),$("#add-klass").val(""),showDialog())},showDialog=function(){$("#add-dialog").attr("class","md-dialog md-dialog__shown"),$("#shade-full").attr("class","shade-shown"),dialogOpen=!0},hideDialog=function(){$("#add-dialog").attr("class","md-dialog md-dialog__hidden"),$("#shade-full").attr("class","shade-hidden"),dialogOpen=!1},$("#add-button").click(function(){clearAndShow()}),$("#shade-full").click(function(){hideDialog()}),$("#cancel").click(function(){hideDialog()})});var week=0;$(function(){week=getWeekNumber(new Date),$("#schema-week").val(week),$("#schema-week").bind("keyup mouseup",function(){""==(week=$("#schema-week").val())?week=1:week>52&&(week=52,$("#schema-week").val(week)),loadSchema()});for(var e=0;e<4;e++)$("."+e+"-header").html("Vecka "+parseInt(week+e));$("#this-week").click(function(){week=getWeekNumber(new Date),$("#schema-week").val(week),loadSchema()}),$.getJSON("https://lserver.alite.am/apps/schema/res/skolmat.json",function(e){$("#skolor").append("\x3c!--[if lte IE 9]><select data-datalist='skolor'><![endif]--\x3e");for(var a=0;a<e.length;a++)$("#skolor").append($("<option></option>").attr("value",e[a].name+" ("+e[a].city+")"));$("#skolor").append("\x3c!--[if lte IE 9]></select><![endif]--\x3e"),loadPolyfill(),loadSchemaFavourites()}),loadSchemaFavourites=function(){$("#favourites-menu").empty();for(var e=0;e<getFoodFavourites().length;e++){var a=$("<li class='md-menu-item'><p class='select-schema-item' id="+e+">"+getFoodFavourites()[e].school+"</p><div class='fav-item-actions'><i class='material-icons delete-schema-item' id="+e+">delete</i></div></li>");e==selected&&a.attr("class","md-menu-item__selected"),$("#favourites-menu").append(a)}$(".delete-schema-item").click(function(e){deleteSchool($(e.target).attr("id")),loadSchemaFavourites()}),$(".select-schema-item").click(function(e){selected=$(e.target).attr("id"),loadSchemaFavourites(),loadSchema(),$("#favourites-menu").attr("class","md-menu md-menu__hidden"),favOpen=!1})},$("#add").click(function(){$.getJSON("https://lserver.alite.am/apps/schema/res/skolmat.json",function(e){for(var a="",t="",o=0;o<e.length;o++)$("#add-skola").val()==e[o].name+" ("+e[o].city+")"&&(a=e[o].name,t=e[o].link);addSchool(a,t),hideDialog(),loadSchemaFavourites()})}),loadSchema=function(){for(var e=0;e<4;e++)$("."+e+"-header").html("Vecka "+parseInt(week+e));$.getJSON("https://allorigins.us/get?method=raw&url="+encodeURIComponent("https://skolmaten.se"+getFoodFavourites()[selected].id+"?&offset="+parseInt(week-getWeekNumber(new Date))+"&limit=3&fmt=json"),function(e){for(t=0;t<5;t++)if(e.weeks[0].days[t].items)for(o=0;o<e.weeks[0].days[t].items.length;o++)$(".1-"+t).append("<li>"+e.weeks[0].days[t].items[o]+"</li>");else $(".1-"+t).html("Ingen data");for(var a=2;a<4;a++)for(var t=0;t<5;t++)if(e.weeks[a-1].days[t].items)for(var o=0;o<e.weeks[a-1].days[t].items.length;o++)$("."+a+"-1-"+t).append("<li>"+e.weeks[a-1].days[t].items[o]+"</li>");else $("."+a+"-1-"+t).html("Ingen data")})}}),getWeekNumber=function(e){(e=new Date(+e)).setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var a=new Date(e.getFullYear(),0,1);return Math.ceil(((e-a)/864e5+1)/7)},$(function(){$.i18n().load({en:"res/i18n/en.json",se:"res/i18n/se.json"}).done(function(){console.log(getLanguage()),$.i18n().locale=getLanguage(),$("body").i18n()})});var loadSchemaFavourites,selected=0,backOpened=!1;$(window).on("popstate",function(){console.log(location.pathname),"/apps/schema/menu"==location.pathname?0==backOpened?(backOpened=!0,openMenu()):(backOpened=!1,closeMenu(),history.back()):closeMenu()}),$(function(){window.navigator.standalone&&($("meta[name='apple-mobile-web-app-status-bar-style']").remove(),$("body").prepend("<div style='height: 20px;width: 100%;background-color: #1976D2;'></div>"),$("#drawer").prepend("<div style='height: 20px;width: 100%;background-color: #1976D2;'></div>")),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&($("#firefox").attr("class","material-icons md-button-fab__icon-firefox"),console.log("firefox"))}),loadSchemaFavourites=function(){$("#favourites-menu").empty();for(var e=0;e<getSchemaFavourites().length;e++){var a=$("<div class='md-menu-item'><p class='select-schema-item' id="+e+">"+getSchemaFavourites()[e].name+" - "+getSchemaFavourites()[e].id+"</p><div class='fav-item-actions'><i class='material-icons delete-schema-item' id="+e+">delete</i></div></div>");e==selected&&a.attr("class","md-menu-item__selected"),$("#favourites-menu").append(a)}$(".delete-schema-item").click(function(e){deleteClass($(e.target).attr("id")),loadSchemaFavourites()}),$(".favourite-schema-item").click(function(e){getSchemaFavourite()==$(e.target).attr("id")?setSchemaFavourite(0):setSchemaFavourite($(e.target).attr("id")),loadSchemaFavourites()}),$(".select-schema-item").click(function(e){selected=$(e.target).attr("id"),loadSchemaFavourites(),loadSchema(),$("#favourites-menu").attr("class","md-menu md-menu__hidden"),favOpen=!1,$("#spinner").attr("class","spinner spinner__shown")})},$(document).keyup(function(e){27==e.keyCode&&(hideDialog(),closeMenu())});var favOpen=!1,weekOpen=!1;$(function(){$("#fav-container").click(function(e){e.stopPropagation()}),$("#week-container").click(function(e){e.stopPropagation()}),$("#star-button").click(function(){1==weekOpen&&($("#week-menu").attr("class","md-menu md-menu__hidden"),weekOpen=!1),1==favOpen?($("#favourites-menu").attr("class","md-menu md-menu__hidden"),favOpen=!1):($("#favourites-menu").attr("class","md-menu md-menu__shown"),favOpen=!0)}),$("#week-button").click(function(){1==favOpen&&($("#favourites-menu").attr("class","md-menu md-menu__hidden"),favOpen=!1),1==weekOpen?($("#week-menu").attr("class","md-menu md-menu__hidden"),weekOpen=!1):($("#week-menu").attr("class","md-menu md-menu__shown"),weekOpen=!0)}),$(window).click(function(){1==favOpen&&($("#favourites-menu").attr("class","md-menu md-menu__hidden"),favOpen=!1),1==weekOpen&&($("#week-menu").attr("class","md-menu md-menu__hidden"),weekOpen=!1)})}),$(function(){window.location.href.indexOf("menu")>-1&&history.back(),$("#menu-schema").click(function(){window.location.href="https://lserver.alite.am/apps/schema"}),$("#menu-skolmat").click(function(){window.location.href="https://lserver.alite.am/apps/schema/skolmat.html"}),$("#menu-settings").click(function(){window.location.href="https://lserver.alite.am/apps/schema/settings.html"}),$("#menu-about").click(function(){window.location.href="https://lserver.alite.am/apps/schema/about.html"})});var week=0;$(function(){$.getJSON("https://lserver.alite.am/apps/schema/res/schools.json",function(e){$("#skolor").append("\x3c!--[if lte IE 9]><select data-datalist='skolor'><![endif]--\x3e");for(var a=0;a<e.length;a++)$("#skolor").append($("<option></option>").attr("value",e[a].namn+" ("+e[a].stad+")"));$("#skolor").append("\x3c!--[if lte IE 9]></select><![endif]--\x3e"),loadPolyfill(),loadSchemaFavourites()}),week=getWeekNumber(new Date),$("#schema-week").val(week),$("#schema-week").bind("keyup mouseup",function(){""==(week=$("#schema-week").val())?week=1:week>52&&(week=52,$("#schema-week").val(week)),loadSchema()}),$("#this-week").click(function(){week=getWeekNumber(new Date),$("#schema-week").val(week),loadSchema()}),$("#add").click(function(){$.getJSON("https://lserver.alite.am/apps/schema/res/schools.json",function(e){for(var a="",t=0;t<e.length;t++)$("#add-skola").val()==e[t].namn+" ("+e[t].stad+")"&&(a=e[t].id,name=e[t].namn);addClass(a,name,$("#add-klass").val()),hideDialog(),loadSchemaFavourites()})})}),$(document).resize(function(){loadSchema()}),$(window).on("orientationchange",function(){loadSchema()}),loadSchema=function(){if($(window).width()>768)$(".desktop-image").attr("src","http://www.novasoftware.se/ImgGen/schedulegenerator.aspx?format=png&schoolid="+getSchemaFavourites()[selected].school+"/sv-se&type=0&id="+getSchemaFavourites()[selected].id+"&period=&week="+week+"&mode=0&printer=0&colors=2&head=1&clock=1&foot=1&day=0&width="+Math.floor($(".desktop-image").outerWidth())+"&height="+Math.floor($(".desktop-image").outerHeight())+"&count=1&decrypt=0");else for(var e=0;e<5;e++)$("."+e).attr("src","http://www.novasoftware.se/ImgGen/schedulegenerator.aspx?format=png&schoolid="+getSchemaFavourites()[selected].school+"/sv-se&type=0&id="+getSchemaFavourites()[selected].id+"&period=&week="+week+"&mode=0&printer=0&colors=2&head=1&clock=1&foot=1&day="+Math.pow(2,e)+"&width="+Math.floor($(".mobile-image").outerWidth())+"&height="+Math.floor($(".mobile-image").outerHeight())+"&count=1&decrypt=0")},getWeekNumber=function(e){(e=new Date(+e)).setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var a=new Date(e.getFullYear(),0,1);return Math.ceil(((e-a)/864e5+1)/7)};var langOpen=!1;$(function(){$("#lang-button").click(function(){0==langOpen?($("#lang-menu").attr("class","md-menu md-menu__shown"),langOpen=!0):($("#lang-menu").attr("class","md-menu md-menu__hidden"),langOpen=!1)}),$("#lang-english").click(function(){$.i18n().load({en:"res/i18n/en.json",se:"res/i18n/se.json"}).done(function(){setLanguage("en"),$.i18n().locale="en",$("body").i18n()}),$("#lang-menu").attr("class","md-menu md-menu__hidden"),langOpen=!1}),$("#lang-swedish").click(function(){$.i18n().load({en:"res/i18n/en.json",se:"res/i18n/se.json"}).done(function(){setLanguage("se"),$.i18n().locale="se",$("body").i18n()}),$("#lang-menu").attr("class","md-menu md-menu__hidden"),langOpen=!1}),$("#lang-item").click(function(e){e.stopPropagation()}),$(window).click(function(){$("#lang-menu").attr("class","md-menu md-menu__hidden"),langOpen=!1}),$("#clear-button").click(function(){clear(),$("#snackbar").attr("class","md-snackbar"),setTimeout(function(){$("#snackbar").attr("class","md-snackbar md-snackbar__hidden")},3e3)})});